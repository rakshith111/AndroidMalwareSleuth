import zipfile
import os
import shutil
from pathlib import Path

def unzip_file(zip_file_path, dest_path):
    with zipfile.ZipFile(zip_file_path, 'r') as zip_ref:
        zip_ref.extractall(dest_path)

def process_zip_file(zip_file_path, parent_directory):
    dest_path = parent_directory / zip_file_path.stem
    dest_path.mkdir(parents=True, exist_ok=True)

    unzip_file(zip_file_path, dest_path)

    for item in dest_path.glob('*'):
        if item.is_file() and item.suffix == '.zip':
            process_zip_file(item, dest_path)

    for root, _, files in os.walk(dest_path):
        for file in files:
            if file.endswith('.json') or file.endswith('.txt'):
                old_path = Path(root) / file
                new_path = dest_path / file
                count = 1

                while new_path.exists():
                    new_dir = dest_path / f"{new_path.stem}_{count}"
                    new_dir.mkdir(parents=True, exist_ok=True)
                    new_path = new_dir / file
                    count += 1

                shutil.move(old_path, new_path)

    for item in dest_path.glob('*'):
        if item.is_dir():
            shutil.rmtree(item)



if __name__ == '__main__':
    dataset_zip = 'CICMalDroiddataset\Dataset.zip'
    with zipfile.ZipFile(dataset_zip, 'r') as zip_ref:
        zip_ref.extractall('CICMalDroiddataset\Dataset')
    dataset_folder = 'CICMalDroiddataset\Dataset'


    parent_directory = Path(dataset_folder)

    for zip_file in parent_directory.glob('*.zip'):
        process_zip_file(zip_file, parent_directory)


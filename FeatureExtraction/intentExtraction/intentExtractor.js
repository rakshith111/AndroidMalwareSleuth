
//to run this file, use the following command: .\intentExtractor.exe <path to apk folder> <path to output folder>
const util = require('util')
const fs = require('fs')
const path = require('path')
const ApkReader = require('adbkit-apkreader')

const apkDirectory = process.argv[2]
const outputDirectory = process.argv[3]

function processApkFile(apkPath, outputDirectory) {
  return ApkReader.open(apkPath)
    .then(reader => reader.readManifest())
    .then(manifest => {
      console.log(`Processing ${apkPath}`)
      console.log(util.inspect(manifest, { depth: null }))
      const outputFileName = path.basename(apkPath, '.apk') + '.json'
      const outputPath = path.join(outputDirectory, outputFileName)
      fs.writeFileSync(outputPath, JSON.stringify(manifest, null, 2))
    })
    .catch(err => console.error(`Error processing ${apkPath}:`, err))
}

const allFiles = fs.readdirSync(apkDirectory)
const apkFiles = allFiles.filter(file => file.endsWith('.apk'))

Promise.all(apkFiles.map(file => processApkFile(path.join(apkDirectory, file), outputDirectory)))
  .then(() => console.log('Finished processing all APK files'))
  .catch(err => console.error('Error:', err))

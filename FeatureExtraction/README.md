## Be Sure to run the pip install -r requirements.txt command to install the required packages before running any of the scripts.

# Abstracted Feature Extraction script

This is just a combination of the FeatureExtraction.py and Intent_permisson_extractor.py scripts. It takes a folder of APKs as input and extracts the features and intents and permissions.The output is a JSON file containing the extracted features and intents and permissions.

```sh
usage: Feature_Extractor.py [-h] -af APK_FOLDER -o OUTPUT_FOLDER [-ic INTENTS_CSV] [-pc PERMISSIONS_CSV] [-u UPDATE] [-ax ADDITIONAL] [-ah API_HEADER_FILE]

Extracts intents, permissions and static features from the given APK file and writes them to a Json file.

optional arguments:
  -h, --help            show this help message and exit
  -af APK_FOLDER, --apk_folder APK_FOLDER
                        Path to the APK folder
  -o OUTPUT_FOLDER, --output_folder OUTPUT_FOLDER
                        Path to the output folder
  -ic INTENTS_CSV, --intents_csv INTENTS_CSV
                        Path to the standard intents CSV file (optional)
  -pc PERMISSIONS_CSV, --permissions_csv PERMISSIONS_CSV
                        Path to the standard permissions CSV file (optional)
  -u UPDATE, --update UPDATE
                        Update jadx to latest version
  -ax ADDITIONAL, --additional ADDITIONAL
                        Additional arguments to be passed to jadx
  -ah API_HEADER_FILE, --api_header_file API_HEADER_FILE
                        path of the API header CSV file

```

For Example:

```sh
python Feature_Extractor.py -af apk/folder -ic ChimeraDataset\Headers\ChimeraDatasetIntent_headers.csv -pc ChimeraDataset\Headers\ChimeraDatasetPermission_headers.csv -o SampleOutput -u True
```

The output folder hierarchy is as follows:

```sh
SampleOutput
│   SAMPLE_1_API.json
│   SAMPLE_2.json
│
└───IntentPermission
        SAMPLE_1_output.json
        androrattest4_output.json

```

Where SAMPLE_1_API.json is the output of the FeatureExtraction.py script and SAMPLE_1_output.json is the output of the Intent_permisson_extractor.py script.

-------------------
# Vectorizer for Android Malware Analysis

This script generates vectorized arrays from JSON files, specifically for Android malware analysis. The input directory should contain JSON files in a specific structure, as detailed below.
### Before running the script, make sure to have built the dataset headers by running the ChimeraDataset\datas_splitter.py script. Else remove the lines that use the headers file.
## Input Directory Structure

The input directory should have the following structure:

```
input_dir
│
└───APIs
│   │   somename_API.json
│
└───IntentPermission
    │   somename_IntentPerms.json
```

Run the script with the input directory as an argument:

```
python vectorizer.py -i <input_directory_path>
```
## Output

The script will output the vectorized arrays for each file, including:

- API Vector
- Intents Vector
- Permissions Vector
- Merged Vector

The output will be printed to the console with colored log messages.



--------------
# Feature Extraction Static Analysis

Feature Extraction is a Python script that uses the jadx tool to extract features from Android APKs. The script takes a folder of APKs as input and uses jadx to decompile the class files to java or kotlin, thes files are given to a custom scanner which we refered to from MobFS. We also used thier rules to extract the features. The output is a JSON file containing the extracted features. The script also has an option to update jadx to the latest version.

```sh
usage: static_analyzer.py [-h] -af APK_FOLDER [-o OUTPUT_FOLDER] [-u UPDATE] [-ax ADDITIONAL]
Process APKs in a folder and extract features

optional arguments:
  -h, --help            show this help message and exit
  -af APK_FOLDER, --apk_folder APK_FOLDER
                        Input Path to folder of APKs to be processed
  -o OUTPUT_FOLDER, --output_folder OUTPUT_FOLDER
                        Output Path to folder of APKs to be processed
  -u UPDATE, --update UPDATE
                        Update jadx to latest version
  -ax ADDITIONAL, --additional ADDITIONAL
                        Additional arguments to be passed to jadx
```

Example:

```sh
python FeatureExtraction.py -af apk/folder -o SampleOutput -u True
```
--------------------
# Intent and permissions Extractor

This script extracts standard intents and permissions from a JSON file containing Android app information.

Its also used to filter out the permissions and intents that are not present in the headers file. For example the headers file is created by running the ChimeraDataset\datas_splitter.py script.

## Usage

```sh
usage: Intent_permisson_extractor.py [-h] -af APK_FOLDER [-ic INTENTS_CSV] [-pc PERMISSIONS_CSV] -o OUTPUT_FOLDER

Extract intents and permissions from a JSON file.

optional arguments:
  -h, --help            show this help message and exit
  -af APK_FOLDER, --apk_folder APK_FOLDER
                        Path to the APK folder
  -ic INTENTS_CSV, --intents_csv INTENTS_CSV
                        Path to the standard intents CSV file (optional)
  -pc PERMISSIONS_CSV, --permissions_csv PERMISSIONS_CSV
                        Path to the standard permissions CSV file (optional)
  -o OUTPUT_FOLDER, --output_folder OUTPUT_FOLDER
                        Path to the output folder

```

For help, run the script with the `-h` or `--help` flag.
e.g.

```sh
python Intent_permisson_extractor.py -af apk/folder  -ic ChimeraDataset\Headers\ChimeraDatasetIntent_headers.csv  -pc ChimeraDataset\Headers\ChimeraDatasetPermission_headers.csv  -o SampleOutput
```

### NOTE : This above command is just an example. You need to change the APK paths to the files and folders accordingly and also have created the headers file in the ChimeraDataset\Headers folder by running the ChimeraDataset\datas_splitter.py script.

--------------------
## Intent Extractor

Extracts `AndroidManifest.xml` from APKs in a specified directory and saves the output as JSON files.

### Usage

```bash
.\intentExtractor.exe <APK folder> <output folder>
```
#### Example

```bash
(working directory) intentExtractor.exe ./apks ./output
```
--------------------
# JADX Downloader

This script downloads and extracts the latest version of jadx, an Android DEX and APK reverse engineering tool. The jadx files are stored in a folder named "jadx", and the latest version is tracked in a separate text file.

# Usage

```bash
python jadxDownloader.py
```

---

## Contributing

Contributions are welcome! If you find any bugs or have suggestions for new features, please open an issue or submit a pull request.

# References

- [MobFS](https://github.com/MobSF/Mobile-Security-Framework-MobSF) For API extraction
- [CICMalDroid](https://www.unb.ca/cic/datasets/maldroid-2020.html)
- [Chimaera](https://ieee-dataport.org/open-access/malware-analysis-datasets-chimera-multimodal-deep-learning-android-malware-detection)

```
    Samaneh Mahdavifar, Andi Fitriah Abdul Kadir, Rasool Fatemi, Dima Alhadidi, Ali A. Ghorbani; Dynamic Android Malware Category Classification using Semi-Supervised Deep Learning, The 18th IEEE International Conference on Dependable, Autonomic, and Secure Computing (DASC), Aug. 17-24, 2020.

    Samaneh Mahdavifar, Dima Alhadidi, and Ali A. Ghorbani (2022). Effective and Efficient Hybrid Android Malware Classification Using Pseudo-Label Stacked Auto-Encoder, Journal of Network and Systems Management 30 (1), 1-34
```

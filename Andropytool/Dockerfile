FROM ubuntu:bionic
ENV DEBIAN_FRONTEND=noninteractive 

# Installing Oracle JDK 8
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
    software-properties-common \
    wget \
    git \
    lib32gcc1 \
    lib32ncurses5 \
    lib32stdc++6 \
    lib32z1 \
    libc6-i386 \
    libgl1-mesa-dev \
    python-pip \
    python-dev \
    gcc \
    python-tk \
    curl \
    && echo "y" | apt-get install openjdk-8-jdk \
    && echo "y" | apt-get install openjdk-8-jre \
    && apt-get install -y python-setuptools unzip \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Installing Android SDK and Android 31
ENV ANDROID_SDK_ROOT=/root/android-sdk-linux
RUN cd / \
    && wget -qO- https://dl.google.com/android/repository/commandlinetools-linux-7583922_latest.zip > cmdline-tools.zip \
    && mkdir -p ${ANDROID_SDK_ROOT}/cmdline-tools \
    && unzip -d ${ANDROID_SDK_ROOT} cmdline-tools.zip 
RUN cd ${ANDROID_SDK_ROOT} \
    ls -la 

RUN rm cmdline-tools.zip \
    && cd ${ANDROID_SDK_ROOT} 

RUN echo y | ${ANDROID_SDK_ROOT}/cmdline-tools/bin/sdkmanager --install "platforms;android-31" --sdk_root=${ANDROID_SDK_ROOT} \
    && echo y | ${ANDROID_SDK_ROOT}/cmdline-tools/bin/sdkmanager --install "build-tools;31.0.0" --sdk_root=${ANDROID_SDK_ROOT} \
    && echo y | ${ANDROID_SDK_ROOT}/cmdline-tools/bin/sdkmanager --install "platform-tools" "platforms;android-31" --sdk_root=${ANDROID_SDK_ROOT} \
    && echo y | ${ANDROID_SDK_ROOT}/cmdline-tools/bin/sdkmanager --install "system-images;android-31;default;x86_64" --sdk_root=${ANDROID_SDK_ROOT} \
    && echo y | ${ANDROID_SDK_ROOT}/cmdline-tools/bin/sdkmanager --install "sources;android-31" --sdk_root=${ANDROID_SDK_ROOT} \
    && chmod -R a+rX ${ANDROID_SDK_ROOT} 
    # && echo "no" | ${ANDROID_SDK_ROOT}/cmdline-tools/bin/sdkmanager --update \ 
    # && echo "no" | ${ANDROID_SDK_ROOT}/cmdline-tools/bin/sdkmanager --update --channel=3 \
    # && echo "no" | ${ANDROID_SDK_ROOT}/cmdline-tools/bin/sdkmanager --update --channel=2 \
    # && echo "no" | ${ANDROID_SDK_ROOT}/cmdline-tools/bin/sdkmanager --update --channel=1

ENV PATH=$PATH:${ANDROID_SDK_ROOT}/platform-tools:${ANDROID_SDK_ROOT}/cmdline-tools/bin \
    ANDROID_EMULATOR_FORCE_32BIT=true \
    TERM=linux \
    TERMINFO=/etc/terminfo

RUN pwd \
    && cd /root/ \
    && git clone --recursive https://github.com/alexMyG/AndroPyTool.git \
    && wget https://github.com/alexMyG/AndroPyTool/releases/download/droidbox_images_patched/images_droidbox.zip \
    && unzip -o images_droidbox.zip -d AndroPyTool/DroidBox_AndroPyTool/images \
    && pip install wheel \
    && pip install -r AndroPyTool/requirements.txt \
    && touch AndroPyTool/avclass/__init__.py \
    && chmod 744 /root/AndroPyTool/run_androPyTool.sh




RUN adb devices; exit 0

VOLUME /apks

EXPOSE 5554 5555

WORKDIR /root/AndroPyTool/

ENTRYPOINT ["python", "-u", "/root/AndroPyTool/androPyTool.py"]
